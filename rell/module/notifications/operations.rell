
operation createNotification(name, threadId: text, usernames: set<text>) {
    val user = user@{ .name == name };
    require(is_signer(user.pubkey));

    val thread = thread@{ .id == threadId };
    for (username in usernames) {
        val toUser = user@?{ .name == username };
        if (toUser != null) {
           create notification(thread, toUser!!, false, op_context.last_block_time);
        }
    }
}

operation markNotificationsSinceTimestampRead(name, timestamp) {
    val user = user@{ .name == name };
    require(is_signer(user.pubkey));
    update notification@*{ .user == user, .timestamp > timestamp } ( read = true );
}